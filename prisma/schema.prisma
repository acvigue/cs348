// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                 @id @default(autoincrement())
  role               UserRole            @default(STUDENT)
  name               String?
  email              String              @unique
  password           String

  verificationTokens VerificationToken[] 

  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  reservations       Reservation[]

  @@map("users")
}

model VerificationToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expires   DateTime
  type      VerificationTokenType
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
}

model Lab {
  id           Int         @id @default(autoincrement())
  building     String
  roomNumber   String
  capacity     Int
  description  String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  equipment    Equipment[]

  @@unique([building, roomNumber])
  @@map("labs")
}

model Equipment {
  id           Int           @id @default(autoincrement())
  name         String
  type         String
  serialNumber String        @unique
  status       EquipmentStatus @default(AVAILABLE)
  description  String?
  labId        Int
  lab          Lab           @relation(fields: [labId], references: [id], onDelete: Cascade)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  reservationLinks ReservationEquipment[]

  @@map("equipment")
}


model Reservation {
  id          Int               @id @default(autoincrement())
  userId      Int
  startTime   DateTime
  endTime     DateTime
  purpose     String
  status      ReservationStatus @default(PENDING)
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipment   ReservationEquipment[]

  @@map("reservations")
}

model ReservationEquipment {
  reservationId Int
  equipmentId   Int
  reservation   Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  equipment     Equipment   @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@id([reservationId, equipmentId])
  @@map("reservation_equipment")
}

enum UserRole {
  STUDENT
  INSTRUCTOR
  ADMIN
}

enum EquipmentStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  OUT_OF_ORDER
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum VerificationTokenType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
}

enum LabAvailability {
  EMPTY
  IN_USE
  FULL
}